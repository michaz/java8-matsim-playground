<!DOCTYPE html>
<meta charset="utf-8">
<style>


</style>
<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>
    var width = 1024;
    var height = 768;
    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

    var g = svg.append("g");
    // zoom and pan
    var zoom = d3.behavior.zoom()
            .on("zoom", function () {
                g.attr("transform", "translate(" + d3.event.translate.join(",") + ")scale(" + d3.event.scale + ")");
            });
    svg.call(zoom);


    d3.dsv(";")("/java8-matsim-playground/output/2015-04-ShapeRutas.csv", function (rows) {
        var path = d3.geo.path().projection(null);
        var geometries = [];
        var routes = {};
        var arcs = [];
        rows.forEach(function (row) {
            var x = row["X-Coordinate"];
            var y = row["Y-Coordinate"];
            routes[row["ROUTE_NAME"]] = routes[row["ROUTE_NAME"]] || [];
            routes[row["ROUTE_NAME"]].push([+x,+y]);
        });
        for (var route in routes) {
            if (routes.hasOwnProperty(route)) {
                geometries.push({type: "LineString", properties: {routeId: route}, arcs: [arcs.length]});
                arcs.push(routes[route]);
            }
        }
        var lineStringGeometryCollection = {type: "GeometryCollection", geometries: geometries};
        var topology = {type: "Topology", objects: {lines: lineStringGeometryCollection}, arcs: arcs};
        var linestrings = topojson.feature(topology, lineStringGeometryCollection);
        var bounds = path.bounds(linestrings);
        var scale = .95 / Math.max((bounds[1][0] - bounds[0][0]) / width, (bounds[1][1] - bounds[0][1]) / height);
        var translate = [(width - scale * (bounds[1][0] + bounds[0][0])) / 2, (height - scale * (bounds[1][1] + bounds[0][1])) / 2];
        zoom.scale(scale).translate(translate);
        zoom.event(svg);
        g.selectAll("path")
                .data(linestrings.features)
                .enter().append("path")
                .attr("d", path)
                .attr("stroke", "black")
                .attr("fill", "none")
                .attr("stroke-width", "5");
        var tr = d3.select("body").append("table").selectAll("tr")
                .data(linestrings.features)
                .enter().append("tr");
        tr.append("td").html(function(f) {return f.properties.routeId});
        tr.append("td").html(function(f) {return f.geometry.coordinates.length})
    });


</script>